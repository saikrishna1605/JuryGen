<!DOCTYPE html>
<html>
<head>
    <title>Firebase Project Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Firebase Project Configuration Test</h1>
    
    <div>
        <h3>Current Configuration:</h3>
        <ul>
            <li><strong>Project ID:</strong> kiro-hackathon23</li>
            <li><strong>API Key:</strong> AIzaSyABU80Orp7q6rALHdorrWmXjZrFdRO7XKU</li>
            <li><strong>Auth Domain:</strong> kiro-hackathon23.firebaseapp.com</li>
        </ul>
    </div>
    
    <button onclick="runAllTests()">Run All Tests</button>
    <div id="results"></div>

    <script>
        const config = {
            apiKey: 'AIzaSyABU80Orp7q6rALHdorrWmXjZrFdRO7XKU',
            authDomain: 'kiro-hackathon23.firebaseapp.com',
            projectId: 'kiro-hackathon23',
            storageBucket: 'kiro-hackathon23.firebasestorage.app',
            messagingSenderId: '1020803101475',
            appId: '1:1020803101475:web:224afc3159e5941e719296'
        };

        function addResult(title, status, message, details = null) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            
            let html = `<h4>${title}</h4><p>${message}</p>`;
            if (details) {
                html += `<details><summary>Details</summary><pre>${JSON.stringify(details, null, 2)}</pre></details>`;
            }
            
            div.innerHTML = html;
            results.appendChild(div);
        }

        async function testProjectExists() {
            try {
                // Test if the project exists by checking the auth domain
                const response = await fetch(`https://${config.authDomain}/__/firebase/init.json`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('Project Existence', 'success', 'Firebase project exists and is accessible', data);
                    return true;
                } else {
                    addResult('Project Existence', 'error', `Project not found or inaccessible (${response.status})`);
                    return false;
                }
            } catch (error) {
                addResult('Project Existence', 'error', `Network error: ${error.message}`);
                return false;
            }
        }

        async function testApiKeyValidity() {
            try {
                // Test API key with a simple Firebase Auth request
                const response = await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${config.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idToken: 'dummy-token' })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    if (data.error.message === 'INVALID_ID_TOKEN') {
                        addResult('API Key Validity', 'success', 'API key is valid (expected INVALID_ID_TOKEN error for dummy token)');
                        return true;
                    } else if (data.error.message === 'API_KEY_INVALID') {
                        addResult('API Key Validity', 'error', 'API key is invalid or expired');
                        return false;
                    } else if (data.error.message === 'CONFIGURATION_NOT_FOUND') {
                        addResult('API Key Validity', 'error', 'Firebase project configuration not found - project may not exist or be suspended');
                        return false;
                    } else {
                        addResult('API Key Validity', 'info', `Unexpected error: ${data.error.message}`, data.error);
                        return false;
                    }
                } else {
                    addResult('API Key Validity', 'success', 'API key is working');
                    return true;
                }
            } catch (error) {
                addResult('API Key Validity', 'error', `Network error: ${error.message}`);
                return false;
            }
        }

        async function testFirebaseConfig() {
            try {
                // Test Firebase configuration by trying to initialize
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                
                const app = initializeApp(config);
                addResult('Firebase Config', 'success', 'Firebase configuration is valid', {
                    name: app.name,
                    options: app.options
                });
                return true;
            } catch (error) {
                addResult('Firebase Config', 'error', `Firebase initialization failed: ${error.message}`, error);
                return false;
            }
        }

        async function testAuthService() {
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getAuth, connectAuthEmulator } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                
                const app = initializeApp(config);
                const auth = getAuth(app);
                
                addResult('Auth Service', 'success', 'Firebase Auth service initialized successfully');
                return true;
            } catch (error) {
                addResult('Auth Service', 'error', `Auth service failed: ${error.message}`, error);
                return false;
            }
        }

        async function runAllTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test-result info"><h4>Running Tests...</h4></div>';
            
            await testProjectExists();
            await testApiKeyValidity();
            await testFirebaseConfig();
            await testAuthService();
            
            // Remove the "Running Tests..." message
            const runningMsg = results.querySelector('.info');
            if (runningMsg) runningMsg.remove();
        }

        // Auto-run tests when page loads
        window.onload = () => {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>